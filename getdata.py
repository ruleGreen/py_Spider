# -*- coding: UTF-8 -*-

import html_downloader
import threading
from bs4 import BeautifulSoup
import time
import codecs
import getIp
import db


serviceId = [u'10203900070769356812440000', u'10300100170769356812440000', u'10203800070769356812440000', u'30317600070769356812440000', u'10462300000693975612440000', u'20328000400693975612440000', u'20328000200693975612440000', u'20328000900693975612440000', u'20328001100693975612440000', u'20328001400693975612440000', u'20328002400693975612440000', u'20328001300693975612440000', u'20328000600693975612440000', u'20328002600693975612440000', u'10245600100693975612440000', u'10245600300693975612440000', u'10245600200693975612440000', u'20242800200693975612440000', u'20242800100693975612440000', u'30328200000693975612440000', u'30328500000693975612440000', u'30004600000693975612440000', u'10097800100693975612440000', u'10097800300693975612440000', u'10097800200693975612440000', u'10342100000693975612440000', u'10106800100693975612440000', u'10106800200693975612440000', u'10106800300693975612440000', u'10106800400693975612440000', u'10106800500693975612440000', u'10106800600693975612440000', u'10106800700693975612440000', u'10002100100693975612440000', u'20421500100693975612440000', u'20421500200693975612440000', u'20421500300693975612440000', u'20421500400693975612440000', u'20421500500693975612440000', u'20421500600693975612440000', u'20421500700693975612440000', u'20421500800693975612440000', u'20421500900693975612440000', u'10333700000693975612440000', u'10333800000693975612440000', u'20244900000693975612440000', u'20242500000693975612440000', u'20002200200693975612440000', u'20002200100693975612440000', u'20328001000693975612440000', u'20328101000693975612440000', u'20328101200693975612440000', u'30405700269645333012440000', u'30202800069645333012440000', u'30233100069645333012440000', u'20405900169645333012440000', u'20406000169645333012440000', u'10454800069645333012440000', u'20236400069645333012440000', u'10241000069645333012440000', u'10349200069645333012440000', u'10349300069645333012440000', u'10349400069645333012440000', u'10349500069645333012440000', u'10288700269645333012440000', u'10288700169645333012440000', u'10288700369645333012440000', u'10288700469645333012440000', u'10288700569645333012440000', u'10241300069645333012440000', u'10241400069645333012440000', u'10349600069645333012440000', u'30464500069645333012440000', u'20240500069645333012440000', u'20240600069645333012440000', u'30337200169645333012440000', u'10345000069645333012440000', u'10345100069645333012440000', u'10239700069645333012440000', u'10345200069645333012440000', u'10288100469645333012440000', u'10288100569645333012440000', u'10288100669645333012440000', u'10288100769645333012440000', u'10288100369645333012440000', u'10288100869645333012440000', u'10288100969645333012440000', u'10288101069645333012440000', u'10288100269645333012440000', u'10288101169645333012440000', u'10288101269645333012440000', u'10288101369645333012440000', u'10288100169645333012440000', u'10288101469645333012440000', u'10288101569645333012440000', u'10288101669645333012440000', u'10239200069645333012440000', u'10347300069645333012440000', u'10347400069645333012440000', u'10347500069645333012440000', u'10239800069645333012440000', u'10348500069645333012440000', u'10348300069645333012440000', u'10348400069645333012440000', u'30455600169645333012440000', u'20234000069645333012440000', u'10454700069645333012440000', u'10240900069645333012440000', u'20235200069645333012440000', u'30105400000694011612440000', u'30095800000694011612440000', u'30095900000694011612440000', u'30096000000694011612440000', u'30103300000694011612440000', u'30103400000694011612440000', u'30095600000694011612440000', u'30095700000694011612440000', u'30228100000694011612440000', u'30105200000694011612440000', u'30228200000694011612440000', u'10251300100694011612440000', u'30095400000694011612440000', u'30095500000694011612440000', u'30103200000694011612440000', u'10251300200694011612440000', u'10251300300694011612440000', u'30101800000694011612440000', u'30102400000694011612440000', u'30102500000694011612440000', u'10250000300694011612440000', u'10251500100694011612440000', u'10251500200694011612440000', u'30096900000694011612440000', u'10251500300694011612440000', u'10249500000694011612440000', u'10250000400694011612440000', u'20251700100694011612440000', u'10250000200694011612440000', u'20252400100694011612440000', u'30223300000694011612440000', u'10250000100694011612440000', u'30227900000694011612440000', u'30227500000694011612440000', u'30227700000694011612440000', u'10465400000694011612440000', u'30460700000694011612440000', u'30460800000694011612440000', u'10465500000694011612440000', u'10465600000694011612440000', u'10465700000694011612440000', u'30100500000694011612440000', u'10133700000694011612440000', u'30103500000694011612440000', u'30103700000694011612440000', u'30096400000694011612440000', u'30098300000694011612440000', u'30096100000694011612440000', u'10465800000694011612440000', u'10465900000694011612440000', u'10466000000694011612440000', u'30459800000694011611440000', u'30459900000694011612440000', u'30460000000694011612440000', u'30460100000694011612440000', u'30460200000694011612440000', u'30460300000694011612440000', u'30460400000694011612440000', u'30460500000694011612440000', u'30460600000694011612440000', u'10281300200693980112440000', u'30337000000693980112440000', u'20330600000693980112440000', u'20330500000693980112440000', u'10281300100693980112440000', u'20344700000693980112440000', u'20342000000693980112440000', u'20341800000693980112440000', u'20341900000693980112440000', u'20030500000693980112440000', u'20278300000693980112440000', u'20288400200693980112440000', u'20288000400693980112440000', u'20288000300693980112440000', u'20288000500693980112440000', u'20288400100693980112440000', u'20288400300693980112440000', u'20288400400693980112440000', u'20288400500693980112440000', u'20288400600693980112440000', u'20288400700693980112440000', u'20288400800693980112440000', u'20288400900693980112440000', u'20288401000693980112440000', u'20288401100693980112440000', u'20288401200693980112440000', u'20288401300693980112440000', u'20288401400693980112440000', u'20288401500693980112440000', u'20288401600693980112440000', u'20288401700693980112440000', u'20288401800693980112440000', u'30030900000693980112440000', u'30026800000693980112440000', u'20205400072510722712440000', u'20215300072510722712440000', u'20206000072510722712440000', u'20205500072510722712440000', u'10288200572510722712440000', u'10259100572510722712440000', u'10288200672510722712440000', u'10259100472510722712440000', u'10360800172510722712440000', u'10361600172510722712440000', u'10204400072510722712440000', u'10206800072510722712440000', u'10361300172510722712440000', u'10207000072510722712440000', u'10204600072510722712440000', u'10206900072510722712440000', u'10205000072510722712440000', u'10206700072510722712440000', u'10206100072510722712440000', u'20205300072510722712440000', u'20205100072510722712440000', u'20296300100694014012440000', u'30112800000694014012440000', u'30112000000694014012440000', u'30111400000694014012440000', u'30295800000694014012440000', u'20235800000694014012440000', u'20296300200694014012440000', u'30290000000694014012440000', u'30111900000694014012440000', u'20112300000694014012440000', u'30289900000694014012440000', u'30111700000694014012440000', u'30111100000694014012440000', u'30111000000694014012440000', u'10276300000694014012440000', u'10110000000694014012440000', u'30112700000694014012440000', u'10439800100694014012440000', u'10439800200694014012440000', u'10439800300694014012440000', u'10439800400694014012440000', u'10439800500694014012440000', u'20231500000694014012440000', u'10390400100694014012440000', u'10390400200694014012440000', u'10390400300694014012440000', u'10390400400694014012440000', u'10109700000694014012440000', u'30111500000694014012440000', u'30113000000694014012440000', u'30110600000694014012440000', u'30112600000694014012440000', u'10115600000694014012440000', u'30111300000694014012440000', u'10000100000000000012440000', u'30449300000694017512440000', u'30449400000694017512440000', u'30449500000694017512440000', u'30449600000694017512440000', u'10463200000694017512440000', u'10463300000694017512440000', u'10463400000694017512440000', u'10463500000694017512440000', u'10356200100694017512440000', u'10356200200694017512440000', u'10223400000694017512440000', u'10405400100694017512440000', u'10008700200694017512440000', u'10008701500694017512440000', u'10008701800694017512440000', u'10079300200694017512440000', u'10079300700694017512440000', u'10079300900694017512440000', u'10097300200694017512440000', u'10097301000694017512440000', u'10097300900694017512440000', u'30131800000694017512440000', u'30461200000694017512440000', u'30097400300694017512440000', u'30449200000694017512440000', u'10273301000694016712440000', u'20312600000694016712440000', u'20312500000694016712440000', u'20352500000694016712440000', u'10312100000694016712440000', u'10244700000694016712440000', u'20287500100694016712440000', u'20287500300694016712440000', u'20287500400694016712440000', u'20125700000694016712440000', u'20312700000694016712440000', u'20287800200694016712440000', u'20287800100694016712440000', u'20287800300694016712440000', u'20287300300694016712440000', u'10286600300694016712440000', u'10272901000694016712440000', u'10403900000694016712440000', u'10272900100694016712440000', u'10272900200694016712440000', u'10272900300694016712440000', u'10272900400694016712440000', u'10272900500694016712440000', u'10272900600694016712440000', u'10272900800694016712440000', u'10272900900694016712440000', u'10272901600694016712440000', u'10272901100694016712440000', u'10273300400694016712440000', u'10273300100694016712440000', u'10273300300694016712440000', u'10273300700694016712440000', u'10273300600694016712440000', u'10273300200694016712440000', u'10463000000694016712440000', u'10286600100694016712440000', u'10286600200694016712440000', u'10286600700694016712440000', u'10286600400694016712440000', u'10286600800694016712440000', u'20287300100694016712440000', u'20287300200694016712440000', u'20287300700694016712440000', u'20287300400694016712440000', u'20287300800694016712440000', u'10286800100694016712440000', u'10286800200694016712440000', u'10286800300694016712440000', u'10286800400694016712440000', u'10286800500694016712440000', u'10286800600694016712440000', u'10287200100694016712440000', u'10287200200694016712440000', u'10287200300694016712440000', u'10287200400694016712440000', u'30057300000693999112440000', u'30057100000693999112440000', u'10276100100693999112440000', u'10276100200693999112440000', u'10058700000693999112440000', u'10236900000693999112440000', u'30056100000693999102440000', u'30056200000693999102440000', u'30056600000693999112440000', u'30058000000693999112440000', u'30056400000693999112440000', u'30057900000693999112440000', u'30057200000693999112440000', u'20188600055361246112440000', u'20185600055361246112440000', u'20188700055361246112440000', u'20239600055361246112440000', u'20188500055361246112440000', u'20252600255361246112440000', u'20252600455361246112440000', u'20252600555361246112440000', u'20252600355361246112440000', u'30316900055361246112440000', u'30317000055361246112440000', u'30317100055361246112440000', u'30320500055361246112440000', u'20188400055361246112440000', u'10192300055361246112440000', u'10458200155361246112440000', u'10238300055361246112440000', u'10187700055361246112440000', u'10181400055361246112440000', u'10238600055361246112440000', u'30430200155361246112440000', u'20239300055361246112440000', u'20411100155361246112440000', u'20411100255361246112440000', u'10053800000693993212440000', u'10052800000693993212440000', u'10052300000693993212440000', u'20052100000693993212440000', u'10314200000693993212440000', u'20409000000693993212440000', u'20409100000693993212440000', u'10410400100693993212440000', u'10374600100693993212440000', u'30371300100693993212440000', u'30372300100693993212440000', u'30374500100693993212440000', u'20055200000693993212440000', u'10053100000693993212440000', u'10052000000693993212440000', u'30321500000693993212440000', u'10321600100693993212440000', u'10321600500693993212440000', u'10321600200693993212440000', u'10321600300693993212440000', u'10321600400693993212440000', u'10321800100693993212440000', u'10321800200693993212440000', u'30321900000693993212440000', u'10386300100693993212440000', u'10338000100693993212440000', u'10338000200693993212440000', u'20338100100693993212440000', u'20338100200693993212440000', u'20405200000693993212440000', u'10411600000693993212440000', u'30411300000693993212440000', u'10247200000694006012440000', u'10380000200694006012440000', u'10380000300694006012440000', u'10380000100694006012440000', u'10074900000694006012440000', u'10206300000694006012440000', u'10076200000694006012440000', u'10237800000694006012440000', u'10247800000694006012440000', u'10248000000694006012440000', u'30073900000694006012440000', u'30074000000694006012440000', u'30074100000694006012440000', u'30074200000694006012440000', u'10377600200694006012440000', u'10377600400694006012440000', u'10377600100694006012440000', u'10377600300694006012440000', u'10249600000693979912440000', u'10464100100693979912440000', u'10278600100693979912440000', u'10278600200693979912440000', u'10278800100693979912440000', u'10278800200693979912440000', u'10278800300693979912440000', u'20292400000693979912440000', u'20237400000693979912440000', u'30013000000693979912440000', u'30022500000693979912440000', u'20414100000693979912440000', u'10350500300693979912440000', u'10350500400693979912440000', u'10350500500693979912440000', u'10350500600693979912440000', u'10350500700693979912440000', u'10350500800693979912440000', u'10350500900693979912440000', u'10350501000693979912440000', u'10350501100693979912440000', u'10350501200693979912440000', u'10351900100693979912440000', u'20428800000693984412440000', u'10412100000693984412440000', u'10100600200693984412440000', u'10100600100693984412440000', u'10100600300693984412440000', u'10359000100693984412440000', u'10100100400693984412440000', u'10100100300693984412440000', u'10099700900693984412440000', u'20100700200693984412440000', u'10099701000693984412440000', u'10099700800693984412440000', u'10099700700693984412440000', u'10100100200693984412440000', u'10099500100693984412440000', u'10099700500693984412440000', u'10099700100693984412440000', u'10099700400693984412440000', u'10099500200693984412440000', u'10100400100693984412440000', u'10099700600693984412440000', u'20100700100693984412440000', u'20107800000693984412440000', u'10100100100693984412440000', u'10099500300693984412440000', u'10099100100693984412440000', u'10107600000693984412440000', u'10100400200693984412440000', u'10099500400693984412440000', u'20126100000693984412440000', u'10107400000693984412440000', u'20407600400693984412440000', u'20412200000693984412440000', u'20101200100693984412440000', u'20101500100693984412440000', u'10098900100693984412440000', u'10098800300693984412440000', u'10099600100693984412440000', u'10099800200693984412440000', u'10098900300693984412440000', u'10099800100693984412440000', u'10099800300693984412440000', u'20238700000693984412440000', u'10099400100693984412440000', u'20101500200693984412440000', u'10099600200693984412440000', u'10250200000693984412440000', u'20107000000693984412440000', u'10098900200693984412440000', u'20101200800693984412440000', u'30327500000693984412440000', u'10447200100693984412440000', u'10407100100693984412440000', u'10407100200693984412440000', u'10407100300693984412440000', u'10331000000693984412440000', u'10331200100693984412440000', u'10331200200693984412440000', u'10331200300693984412440000', u'10331600000693984412440000', u'10407200100693984412440000', u'10412600000693984412440000', u'10447000100693984412440000', u'10447100100693984412440000', u'10353500100694113512440000', u'30230400000694113512440000', u'10002900100694113512440000', u'10146100000694113512440000', u'10146000000694113512440000', u'10145900000694113512440000', u'30440400000694113512440000', u'10353300100694113512440000', u'10079100300694113512440000', u'30440500000694113512440000', u'10465000000694113512440000', u'10145700000694113512440000', u'10145400000694113512440000', u'20079100200694113512440000', u'10146200000694113512440000', u'10145800000694113512440000', u'30229800000694113512440000', u'30230700000694113512440000', u'10333300000693990812440000', u'10391500000693990812440000', u'10311900000693990812440000', u'10309300000693990812440000', u'20310500000693990812440000', u'10309700000693990802440000', u'20270900000693990802440000', u'30313400000693990812440000', u'30313300000693990812440000', u'10332400000693990812440000', u'10332500000693990812440000', u'10332600000693990812440000', u'10332900000693990812440000', u'10468700000693990812440000', u'10411900000693990812440000', u'10310100000693990812440000', u'20413800100693990812440000', u'10273100000693990812440000', u'10309200000693990812440000', u'10275600000693990812440000', u'10274300000693990812440000', u'20310700000693990812440000', u'20270700000693990802440000', u'20301100000693990802440000', u'10309500000693990812440000', u'10456700100693990812440000', u'20411400000693990812440000', u'10331800000693990812440000', u'10390700000693990812440000', u'20271100000693990812440000', u'10456800100693990812440000', u'10466200000693990812440000', u'10456900100693990812440000', u'10468400000693990812440000', u'20311000000693990812440000', u'20311500000693990812440000', u'20271300000693990812440000', u'10456600100693990812440000', u'10354400100693990812440000', u'10428900300693990812440000', u'10428900400693990812440000', u'10354500100693990812440000', u'10310200000693990812440000', u'10276700000693990812440000', u'10310400000693990812440000', u'10274700000693990812440000', u'20276400000693990812440000', u'20276200000693990812440000', u'20275400000693990812440000', u'20272000000693990812440000', u'20310900000693990812440000', u'20310800000693990812440000', u'10272500000693990812440000', u'10455000100693990812440000', u'10274200000693990812440000', u'20284100300693991612440000', u'20046300000693991612440000', u'20048900000693991612440000', u'10263900000693991612440000', u'10376500200693991612440000', u'20409700100693991612440000', u'20409800100693991612440000', u'20409900100693991612440000', u'10295300100693991612440000', u'10295300200693991612440000', u'10295300300693991612440000', u'10295400300693991612440000', u'10047000000693991612440000', u'10269700000693991612440000', u'10047500000693991612440000', u'10048300000693991612440000', u'10281100000693991612440000', u'10295300400693991612440000', u'10347100200693991612440000', u'10464600100693991612440000', u'10464700100693991612440000', u'20347900200693991612440000', u'10464800100693991612440000', u'10369700100693991612440000', u'10464300100693991612440000', u'10464300200693991612440000', u'10464400100693991612440000', u'10464400200693991612440000', u'10464400300693991612440000', u'10464400400693991612440000', u'10295500300693991612440000', u'10295500400693991612440000', u'10295500500693991612440000', u'20409600100693991612440000', u'30006800000693978012440000', u'10095200100693978012440000', u'10095200200693978012440000', u'20008900000693978012440000', u'10329200000693978012440000', u'10329400209692752012440000', u'10329400109692752012440000', u'10329500000693978012440000', u'10329900009692752012440000', u'20105700200693978012440000', u'20105700400693978012440000', u'20105700300693978012440000', u'10346800109692752012440000', u'10346800209692752012440000', u'10346900109692752012440000', u'20007400100693978012440000', u'10352300009692752012440000', u'20010700100693978012440000', u'20010700200693978012440000', u'20126500000693978012440000', u'20009600000693978012440000', u'20008400200693978012440000', u'20008400100693978012440000', u'20010900000693978012440000', u'10010200300693978012440000', u'20403600109692752012440000', u'10010200200693978012440000', u'30329300000693978012440000', u'30406500109692752012440000', u'10010200100693978012440000', u'10006100200693978012440000', u'10006100100693978012440000', u'30329600000693978012440000', u'20329700000693978012440000', u'10080100000693978012440000', u'10008300100693978012440000', u'10345400109692752012440000', u'10008300200693978012440000', u'10097900100693978012440000', u'10097900200693978012440000', u'10097900300693978012440000', u'10412000000694007912440000', u'10332100000694007912440000', u'10356000000694007912440000', u'20078800000694007912440000', u'20094400200694007912440000', u'20094700100694007912440000', u'20094800100694007912440000', u'20094800200694007912440000', u'20289500000694007912440000', u'20094900100694007912440000', u'20094900200694007912440000', u'30289200000694007912440000', u'30098700100694007912440000', u'30098700200694007912440000', u'20094500300694007912440000', u'20080300000694007912440000', u'10459200100694007912440000', u'20076900000694007912440000', u'30462100000694007912440000', u'10462600100694007912440000', u'10462900000694007912440000', u'20079600100694007912440000', u'20079600200694007912440000', u'20094300100694007912440000', u'20094300300694007912440000', u'10094100100694007912440000', u'10079900000694007912440000', u'10094200100694007912440000', u'10094200200694007912440000', u'10300300000694007912440000', u'10079800000694007912440000', u'10466100000694007912440000', u'10093600200694007912440000', u'10459000100694007912440000', u'10300200000694007912440000', u'10459100100694007912440000', u'10094200400694007912440000', u'10077500000694007912440000', u'10331700000694007912440000', u'10458800100694007912440000', u'10332000000694007912440000', u'20405000000694007912440000', u'20405500000694007911440000', u'20404800000694007912440000', u'10458900100694007912440000', u'10080200000694007912440000', u'10093700100694007912440000', u'10349100000694013212440000', u'20350300000694013212440000', u'20350400000694013212440000', u'10351100000694013212440000', u'10351200000694013212440000', u'10351300000694013212440000', u'10351400000694013212440000', u'10351500000694013212440000', u'10351600000694013212440000', u'10351700000694013212440000', u'10351800000694013212440000', u'10354600000694013212440000', u'10282300300694013212440000', u'10282600300694013212440000', u'10282300200694013212440000', u'10282101000694013212440000', u'10282300100694013212440000', u'10275900200694013212440000', u'10279800100694013212440000', u'10275900100694013212440000', u'10275900400694013212440000', u'10282100300694013212440000', u'10282200300694013212440000', u'10277700200694013212440000', u'10282600500694013212440000', u'10282600400694013212440000', u'10282100800694013212440000', u'10282100100694013212440000', u'10282101300694013212440000', u'10282101200694013212440000', u'10282100700694013212440000', u'10282200100694013212440000', u'10282200200694013212440000', u'10282100500694013212440000', u'10282100600694013212440000', u'10282100200694013212440000', u'10282101100694013212440000', u'10282600100694013212440000', u'10236600000694013212440000', u'10279800200694013212440000', u'20282800200694013212440000', u'10275900300694013212440000', u'10282300500694013212440000', u'10282600200694013212440000', u'10282300400694013212440000', u'10282200400694013212440000', u'10282100900694013212440000', u'20282800100694013212440000', u'20253400000694013212440000', u'10277700100694013212440000', u'10404500100694013212440000', u'10404500200694013212440000', u'10355300200694013212440000', u'10355300100694013212440000', u'20350600000694013212440000', u'10440200000694013212440000', u'20350700000694013212440000', u'30456200100694013212440000', u'30456200300694013212440000', u'30456200200694013212440000', u'20350800000694013212440000', u'20350900000694013212440000', u'10351000000694013212440000', u'30456400000694013212440000', u'30462000100694013212440000', u'30456500000694013212440000', u'10462800100694013212440000', u'10282500100694013212440000', u'20236000000694013212440000', u'10282500200694013212440000', u'10251900000694013212440000', u'10282500400694013212440000', u'10292300000694013212440000', u'10282500300694013212440000', u'10251100000694013212440000', u'10282500500694013212440000', u'30072300000694002812440000', u'30073300000694002812440000', u'30073000000694002812440000', u'30228000075833616512440000', u'30250500075833616512440000', u'30226100075833616512440000', u'30327100075833616512440000', u'30232600075833616512440000', u'30230200075833616512440000', u'30250400075833616512440000', u'30228800075833616512440000', u'30231900075833616512440000', u'30251000075833616512440000', u'30250300075833616512440000', u'30250100075833616512440000', u'30252100075833616512440000', u'30438900000694129012440000', u'30439000000694129012440000', u'30439100000694129012440000', u'30439200000694129012440000', u'30439300000694129012440000', u'30439400000694129012440000', u'30439500000694129012440000', u'30439600000694129012440000', u'30439700000694129012440000', u'30437800000694129012440000', u'30438000000694129012440000', u'30438100000694129012440000', u'30438200000694129012440000', u'30438300000694129002440000', u'30438400000694129012440000', u'30438500000694129012440000', u'30438600000694129012440000', u'30438700000694129012440000', u'30438800000694129012440000', u'30436800000694129012440000', u'30436900000694129012440000', u'30437000000694129012440000', u'30437100000694129012440000', u'30437200000694129012440000', u'30437300000694129012440000', u'30437400000694129012440000', u'30437500000694129012440000', u'30437600000694129012440000', u'30437700000694129012440000', u'30435800000694129012440000', u'30435900000694129012440000', u'30436000000694129012440000', u'30436100000694129012440000', u'30436200000694129012440000', u'30436300000694129012440000', u'30436400000694129012440000', u'30436500000694129012440000', u'30436600000694129012440000', u'30436700000694129012440000', u'30434800000694129012440000', u'30434900000694129012440000', u'30435000000694129012440000', u'30435100000694129012440000', u'30435200000694129012440000', u'30435300000694129012440000', u'30435400000694129012440000', u'30435500000694129012440000', u'30435600000694129012440000', u'30435700000694129012440000', u'30433800000694129012440000', u'30433900000694129012440000', u'30434000000694129012440000', u'30434100000694129012440000', u'30434200000694129012440000', u'30434300000694129012440000', u'30434400000694129012440000', u'30434500000694129012440000', u'30434600000694129012440000', u'30434700000694129012440000', u'30432800000694129012440000', u'30432900000694129012440000', u'30433000000694129012440000', u'30433100000694129012440000', u'30433200000694129012440000', u'30433300000694129012440000', u'30433400000694129012440000', u'30433500000694129012440000', u'30433600000694129012440000', u'30433700000694129012440000', u'30431800000694129012440000', u'30431900000694129012440000', u'30432000000694129012440000', u'30432100000694129012440000', u'30432200000694129012440000', u'30437900000694129012440000', u'30432400000694129012440000', u'30432500000694129012440000', u'30432600000694129012440000', u'30432700000694129012440000', u'10430700000694129012440000', u'10430800000694129012440000', u'30430900000694129012440000', u'30431000000694129012440000', u'30431100000694129012440000', u'30431200000694129012440000', u'30431300000694129012440000', u'30431500000694129012440000', u'30431600000694129012440000', u'30431700000694129012440000', u'20300500000694012412440000', u'10108200000694012412440000', u'10313600000694012412440000', u'10108300000694012412440000', u'10298600300693981X12440000', u'10298600200693981X12440000', u'10298600100693981X12440000', u'10031100000693981X12440000', u'10297402100694001X12440000', u'10297404500694001X12440000', u'10297402000694001X12440000', u'10297401900694001X12440000', u'10297600100694001X12440000', u'10297900300694001X12440000', u'10297403000694001X12440000', u'10297403900694001X12440000', u'10297401400694001X12440000', u'10297400400694001X12440000', u'10297403100694001X12440000', u'10297800400694001X12440000', u'10297402300694001X12440000', u'10297401100694001X12440000', u'10297404300694001X12440000', u'10297900200694001X12440000', u'10297402200694001X12440000', u'10297800100694001X12440000', u'10297404000694001X12440000', u'10297400900694001X12440000', u'10297403200694001X12440000', u'10297403800694001X12440000', u'10297400300694001X12440000', u'10297404400694001X12440000', u'10297404700694001X12440000', u'10297403400694001X12440000', u'10297403700694001X12440000', u'10297401600694001X12440000', u'10297401000694001X12440000', u'10297402400694001X12440000', u'10297401200694001X12440000', u'10297400200694001X12440000', u'10297400800694001X12440000', u'10297401500694001X12440000', u'10297402800694001X12440000', u'10297404900694001X12440000', u'10297402600694001X12440000', u'10297402700694001X12440000', u'10297400600694001X12440000', u'10297404200694001X12440000', u'10297800200694001X12440000', u'10297401800694001X12440000', u'10297403500694001X12440000', u'10297404800694001X12440000', u'10297900100694001X12440000', u'10297400500694001X12440000', u'10297800300694001X12440000', u'30066900000694001X12440000', u'10297700100694001X12440000', u'10297400700694001X12440000', u'10297403600694001X12440000', u'10297400100694001X12440000', u'10297403300694001X12440000', u'10329000000694001X12440000', u'20354700000694001X12440000', u'30357400000694001X12440000', u'30357700000694001X12440000', u'30071500000694001X12440000', u'30066200000694001X12440000', u'30298100000694001X12440000', u'10297404600694001X12440000', u'10297500200694001X12440000', u'10289800200694001X12440000', u'10297401700694001X12440000', u'30298200000694001X12440000', u'10297500100694001X12440000', u'10289800300694001X12440000', u'30065800000694001X12440000', u'10297401300694001X12440000', u'10297404100694001X12440000', u'10297402900694001X12440000', u'10297402500694001X12440000', u'10289800100694001X12440000', u'10297500300694001X12440000', u'30308600000694009512440000', u'30308500000694009512440000', u'30308400000694009512440000', u'30299900100694009512440000', u'30299900200694009512440000', u'30299900300694009512440000', u'20311700000694009512440000', u'30304600100694009512440000', u'30304600200694009512440000', u'30300000100694009512440000', u'30300000300694009512440000', u'30300000200694009512440000', u'30300000400694009512440000', u'30299800100694009512440000', u'30299800400694009512440000', u'30299800200694009512440000', u'30299800300694009512440000', u'30299700200694009512440000', u'30299700100694009512440000', u'30308300000694009512440000', u'30308200000694009512440000', u'30308900000694009512440000', u'30309100000694009512440000', u'30308700000694009512440000', u'10376400000694009512440000', u'10376800000694009512440000', u'10089400000694009512440000', u'10307900000694009512440000', u'10302000100694009512440000', u'10091800000694009512440000', u'30308800000694009512440000', u'20309000000694009512440000', u'20086700000694009512440000', u'20088100000694009512440000', u'20091700000694009512440000', u'20309400000694009512440000', u'20311800000694009512440000', u'20304000100694009512440000', u'10290700100694009512440000', u'20390500000694009512440000', u'10384600000694009512440000', u'10384400000694009512440000', u'10384500000694009512440000', u'10384800000694009512440000', u'20389700000694009512440000', u'20389600000694009512440000', u'20390000000694009512440000', u'20390100000694009512440000', u'20389900000694009512440000', u'10090600000694009512440000', u'10301400600694009512440000', u'10091400000694009512440000', u'10301400500694009512440000', u'10301400200694009512440000', u'10092000000694009512440000', u'10301400300694009512440000', u'10091000000694009512440000', u'10301400400694009512440000', u'10301400100694009512440000', u'10089800000694009512440000', u'10090800000694009512440000', u'10307800000694009512440000', u'10302900100694009512440000', u'10090400000694009512440000', u'10090000000694009512440000', u'10303000100694009512440000', u'10093000000694009512440000', u'10088500000694009512440000', u'10090300000694009512440000', u'10088900000694009512440000', u'10301500100694009512440000', u'10081300000694009512440000', u'20082900000694009512440000', u'20083300000694009512440000', u'20083500000694009512440000', u'20084200000694009512440000', u'10331300000694009512440000', u'10331400100694009512440000', u'10331400200694009512440000', u'10331400300694009512440000', u'10331500100694009512440000', u'10331500200694009512440000', u'10331500300694009512440000', u'10081000000694009512440000', u'20296000100694009512440000', u'20296000200694009512440000', u'10337600100694009512440000', u'10446800000694009512440000', u'10446900000694009512440000', u'20383200000694009512440000', u'20296100100694009512440000', u'20296100200694009512440000', u'10081800000694009512440000', u'20081600000694009512440000', u'10295900100694009512440000', u'10295900200694009512440000', u'20080800000694009512440000', u'10084300000694009512440000', u'10082400000694009512440000', u'10082700000694009512440000', u'20083200000694009512440000', u'10082300000694009512440000', u'10171600000694133812440000', u'20171900000694133812440000', u'20292000200694133812440000', u'20291900100694133812440000', u'20291900200694133812440000', u'20291900300694133812440000', u'10176200000694133812440000', u'10291600100694133812440000', u'20292100400694133812440000', u'20292100300694133812440000', u'10291600200694133812440000', u'10170200000694133812440000', u'20291801200694133812440000', u'20291801100694133812440000', u'10291500800694133812440000', u'10344000000694133812440000', u'10291300700694133812440000', u'10291300800694133812440000', u'10458700000694133812440000', u'10412300100694133812440000', u'10291400100694133812440000', u'10170300000694133812440000', u'10176900000694133812440000', u'10287400300694133812440000', u'10291200100694133812440000', u'10291200200694133812440000', u'10172200000694133812440000', u'10330300000694029812440000', u'10007900500694029812440000', u'10408300000694029811440000', u'10007900300694029802440000', u'10361200100694029812440000', u'10361200200694029812440000', u'10361200300694029812440000', u'10361200400694029812440000', u'10361200500694029812440000', u'10361200600694029812440000', u'10361200700694029812440000', u'10361200800694029812440000', u'10361200900694029812440000', u'10361201000694029812440000', u'10361201100694029812440000', u'10007900100694029812440000', u'10415600000694029812440000', u'30140400000694029812440000', u'10138400000694029812440000', u'10138100000694029812440000', u'10097200100694029812440000', u'10097200500694029812440000', u'10097200200694029812440000', u'10097200300694029812440000', u'10007901300694029812440000', u'10007901400694029812440000', u'10007900600694029812440000', u'10007901200694029812440000', u'10007901500694029812440000', u'10007901800694029812440000', u'10007900800694029812440000', u'10007901000694029812440000', u'10007901600694029812440000', u'10007901100694029812440000', u'10007900700694029812440000', u'10007900900694029812440000', u'10007901700694029812440000', u'10007902000694029812440000', u'10007901900694029812440000', u'10010100300694029812440000', u'10010100600694029812440000', u'10010100100694029812440000', u'10360100100694029812440000', u'10360100200694029812440000', u'10360100300694029812440000', u'10360100400694029812440000', u'10360100500694029812440000', u'10360100600694029812440000', u'10360100700694029812440000', u'10360100800694029812440000', u'10360100900694029812440000', u'10010100200694029812440000', u'10299200000694029812440000', u'10360500100694029812440000', u'10360500200694029812440000', u'10140800000694029812440000', u'10010400100694029812440000', u'10010100700694029812440000', u'10010100800694029812440000', u'10010100900694029812440000', u'10010400200694029812440000', u'10140900000694029812440000', u'10139900000694029812440000', u'10140100000694029812440000', u'10140600000694029812440000', u'10140200000694029812440000', u'10406300000694029812440000', u'10010400300694029812440000', u'10285500575833307912440000', u'10285500175833307912440000', u'10285500275833307912440000', u'10285500375833307912440000', u'10285500475833307912440000', u'30289100175833307912440000', u'30289100275833307912440000', u'30278400000694033502440000', u'30279700000694033502440000', u'30232700000694033502440000', u'30279200000694033502440000', u'30279600000694033512440000', u'30234700000694033502440000', u'30234400000694033502440000', u'30316400000694033502440000', u'30316300000694033502440000', u'30316200000694033502440000', u'30278200000694033502440000', u'20312300000694024712440000', u'20289600200694024712440000', u'20290900200694024712440000', u'20290900100694024712440000', u'20289600100694024712440000', u'10296800375921412712440000', u'10296800175921412712440000', u'10296800675921412712440000', u'10296800475921412712440000', u'10296800275921412712440000', u'30449900000694124X12440000', u'30450000000694124X12440000', u'30450100000694124X12440000', u'10440700000694124X12440000', u'10454300000694124X12440000', u'30450300000694124X12440000', u'30450400000694124X12440000', u'30450500000694124X12440000', u'30450600000694124X12440000', u'10454400000694124X12440000', u'30450700000694124X12440000', u'30450900000694124X12440000', u'30451100000694124X12440000', u'30451300000694124X12440000', u'30451400000694124X12440000', u'30451500000694124X12440000', u'30451600000694124X12440000', u'30451700000694124X12440000', u'10451900000694124X12440000', u'10284900100694124X12440000', u'10284900400694124X12440000', u'10285201700694124X12440000', u'10284700100694124X12440000', u'10285200700694124X12440000', u'10284700200694124X12440000', u'20261300000694124X12440000', u'10285201300694124X12440000', u'10284900200694124X12440000', u'10403400100694124X12440000', u'10439900000694124X12440000', u'10440000000694124X12440000', u'10285700100694124X12440000', u'10440100000694124X12440000', u'10450200000694124X12440000', u'10450800000694124X12440000', u'10452300000694124X12440000', u'10452400000694124X12440000', u'10453200000694124X12440000', u'10453300000694124X12440000', u'10453900000694124X12440000', u'10454000000694124X12440000', u'10285400200694124X12440000', u'30319900000694124X12440000', u'10285400100694124X12440000', u'10285100100694124X12440000', u'10286000100694124X12440000', u'10284600200694124X12440000', u'30315400000694124X12440000', u'10285600600694124X12440000', u'10285000300694124X12440000', u'10285001200694124X12440000', u'10285600200694124X12440000', u'30319800000694124X12440000', u'10284601100694124X12440000', u'10285600300694124X12440000', u'10285600100694124X12440000', u'10285000900694124X12440000', u'10285800700694124X12440000', u'10264600000694124X12440000', u'10284800400694124X12440000', u'10285800600694124X12440000', u'10284600100694124X12440000', u'10285900600694124X12440000', u'10284600900694124X12440000', u'10285800800694124X12440000', u'30320000000694124X12440000', u'10284601000694124X12440000', u'10286000200694124X12440000', u'10285600400694124X12440000', u'20418800000694124X12440000', u'20418900000694124X12440000', u'20419000000694124X12440000', u'20419100000694124X12440000', u'20440300000694124X12440000', u'30440800000694124X12440000', u'30440900000694124X12440000', u'30441100000694124X12440000', u'30441200000694124X12440000', u'30441300000694124X12440000', u'10452100000694124X12440000', u'10452900000694124X12440000', u'10453400000694124X11440000', u'10453500000694124X01440000', u'30457300045585717412440000', u'20328800045585717412440000', u'30177500045585717412440000', u'30177400045585717412440000', u'30300000045586272312440000', u'30306000045586272312440000', u'30317800045586272312440000', u'30318200045586272312440000', u'30304800045586272312440000', u'30317900045586272312440000', u'30304700045586272312440000', u'30299900045586272312440000', u'30318300045586272312440000', u'30318900045586272312440000', u'30303500045586272312440000', u'30318700045586272312440000', u'30318600045586272312440000', u'30305900045586272312440000', u'30305200045586272312440000', u'30318800045586272312440000', u'30303700045586272312440000', u'30305800045586272312440000', u'30318100045586272312440000', u'30318000045586272312440000', u'30299600045586272312440000', u'30319100045586272312440000', u'30326600045586272312440000', u'30326700045586272312440000', u'30326800045586272312440000', u'30327000045586272312440000', u'30305700045586272312440000', u'30305000045586272312440000', u'30303600045586272312440000', u'30304900045586272312440000', u'30318500045586272312440000', u'30319000045586272312440000', u'30430400000694109812440000', u'10447500000694109812440000', u'10457000000694109812440000', u'30326100000694109812440000', u'10241800200694109812440000', u'10241800100694109812440000', u'10145200000694109812440000', u'10144900000694109812440000', u'10253200000694108X12440000', u'10253000000694108X12440000', u'10452800000694112712440000', u'10453000000694112712440000', u'10453100000694112712440000', u'10414400000694118612440000', u'10414200000694118612440000', u'10414900000694118612440000', u'30424000100694118612440000', u'30424100000694118612440000', u'30424300000694118612440000', u'10415100000694118612440000', u'30424200000694118612440000', u'10293300000694118612440000', u'10300900000694118612440000', u'30301200000694118612440000', u'10292200000694118612440000', u'10293600000694118612440000', u'10299300000694118612440000', u'10300700000694118612440000', u'10300800000694118612440000', u'10292700000694118612440000', u'10293000000694118612440000', u'30148600000694118612440000', u'10177000019038095512440000', u'10330400019038095512440000', u'10177200019038095512440000', u'10339000019038095512440000', u'10339100019038095512440000', u'10339200019038095512440000', u'10455900000694038612440000', u'10455800000694038612440000', u'10456000000694038612440000', u'10288500200694038612440000', u'10286200500694038612440000', u'10288500100694038612440000', u'10286200300694038612440000', u'10286200400694038612440000', u'10288500300694038612440000', u'10286200100694038612440000', u'10286200200694038612440000', u'10448500000693962-12440000', u'10448600000693962-12440000', u'10448100000693962-12440000', u'10448700000693962-12440000', u'10449000000693962-12440000', u'10448900000693962-12440000', u'10448800000693962-12440000']



column_name_pro = ['事项编码','发布机构','名称','事项性质','主管部门','受理机构']
column_name_view = ['事项编码','办理对象','办理条件','所需材料',
                '办理时限','办事窗口','收费标准','办理依据','网上申办到现场','承诺期限','备注']

column_val_pro = []
column_val_view = []

class GetData(threading.Thread):
    def __init__(self,servicelist):
        threading.Thread.__init__(self)
        self.servicelist = servicelist
        self.downloader = html_downloader.HtmlDownloader()

    def _get_new_data_pro(self, id, soup):
        head1 = []
        middle1 = []
        last1 = []

        div_node =soup.find('div',class_='offices')
        # for sub in div_node:
        #     tr_node = sub.find_all('tr')
        #     for subsub in tr_node:
        #         td_node = subsub.find_all('td')
        #         th_node =subsub.find_all('th')
        #         for subsubsub in td_node:
        #             print(subsub.string)

        tr_node = div_node.find_all('tr')
        for sub in tr_node:
            td_node = sub.find_all('td')
            for subsub in td_node:
                head1.append(subsub.string)

        div_node2 = div_node.find_next_siblings()
        for sub in div_node2:
            tr_node = sub.find_all('tr')
            for subsub in tr_node:
                th_node = subsub.find_all('th')
                td_node = subsub.find_all('td')
                for subsubsub in th_node:
                    middle1.append(subsubsub.string)
                for subsubsub in td_node:
                    last1.append(subsubsub.string)
        try:
            column_val_pro.append([head1[1], head1[5], head1[9], head1[3], last1[17], last1[18]])
        except IndexError:
            column_val_pro.append([head1[1], head1[5], head1[9], head1[3], last1[7], last1[8]])





    def _get_new_data_form(self,id,soup):
        head2 = []
        middle2 = []


        div_node = soup.find('div',class_='span9 right')

        div_node1 = div_node.find('div',class_='rightTag')
        tr_node   = div_node1.find('tr')
        td_node   = tr_node.find_all('td')
        for sub in td_node:
            tr_node = sub.find_all('td')
            for subsub in tr_node:
                head2.append(subsub.get_text())

        div_node3 = div_node.find_all('div',class_='instructions')
        for sub in div_node3:
            try:
                pre_node = sub.find('pre')
                # print(pre_node.string)
                middle2.append(pre_node.get_text())
            except AttributeError:
                continue

        # column_name_view = ['事项编码', '办理对象', '办理条件', '所需材料',
        #                    '办理时限', '办事窗口', '收费标准', '办理依据', '网上申办到现场', '承诺期限', '备注']

        if(len(head2)<3):
            column_val_view.append([id,middle2[0],middle2[1],middle2[2],middle2[5],middle2[6],middle2[7],middle2[8]
                    ,u'无',head2[0]+head2[1],middle2[9]])
        else:
            column_val_view.append([id, middle2[0], middle2[1], middle2[2], middle2[5], middle2[6], middle2[7], middle2[8]
                    , head2[1], head2[4] + head2[5], middle2[9]])

        # 办事窗口




    def  _getprocedure(self):
        count =1
        self.downloader.getProxy(getIp.checkedProxyList)
        print("本次选取的代理ip:" + self.downloader.ip + ":" + self.downloader.port)
        # url = "http://www.gdbs.gov.cn/portal/public/proceduresView?serviceSubjectIdurl=10349200069645333012440000"
        # html_doc = self.downloader.download(url)
        # soup = BeautifulSoup(html_doc, 'html.parser', from_encoding='utf8')
        # self._get_new_data_pro(id, soup)
        for id in self.servicelist:
            url = "http://www.gdbs.gov.cn/portal/public/proceduresView?serviceSubjectId="+ id
            html_doc =self.downloader.download(url)
            if html_doc!=None:
                soup = BeautifulSoup(html_doc, 'html.parser', from_encoding='utf8')
                self._get_new_data_pro(id,soup)
            print(count)
            count = count + 1

    def  _getformview(self):
        count =1
        # 每个线程选择一个代理
        self.downloader.getProxy(getIp.checkedProxyList)
        print("本次选取的代理ip:"+self.downloader.ip+":"+self.downloader.port)
        for id in self.servicelist:
            url = "http://www.gdbs.gov.cn/portal/serviceSubject/formView?serviceSubjectId=" + id
            html_doc = self.downloader.download(url)
            soup = BeautifulSoup(html_doc, 'html.parser', from_encoding='utf8')
            self._get_new_data_form(id,soup)
            print(count)
            count = count +1

class Output:
    def __init__(self):
        self.datas = []

    def collect_data(self,new_data):
        if new_data is None:
            return
        self.datas = new_data


    def output1_txt(self):
        fout = codecs.open('output1.txt', 'w')
        for data in self.datas:
            for dat in data:
                # print(type(dat))
                # dat = dat.encode('utf-8')
                fout.write(dat.encode("utf-8")+' ')
            fout.write('\n')
        fout.close()

    def output2_txt(self):
        fout = codecs.open('output2.txt', 'w')
        for data in self.datas:
            for dat in data:
                # print(type(dat))
                # dat = dat.encode('utf-8')
                # 存在受理机构为空的情况
                if(dat==None):
                    fout.write(u'无'.encode("utf-8")+'')
                else:
                    fout.write(dat.encode("utf-8")+' ')
            fout.write('\n')
        fout.close()

if __name__ == '__main__':
    # data = GetData()
    # # data._getprocedure()
    # data._getformview()
    # print(column_val_view[0][0])
    # print(column_val_view)
    # #print(column_val_pro)

    print("爬取代理ip......")
    getIp.mian()

    getforms1 = []
    getforms2 =  []

    getpros1 = []
    getpros2 = []

    # 开启20个

    for i in range(15):
        t = GetData(serviceId[((len(serviceId) + 14) / 15) * i:((len(serviceId) + 14) / 15) * (i + 1)])
        getforms1.append(t)

    for i in range(len(getforms1)):
        getforms1[i]._getformview()
        time.sleep(10)

    time.sleep(300)

    for i in range(15):
        t =GetData(serviceId[((len(serviceId) + 14) / 15) * i:((len(serviceId) + 14) / 15) * (i + 1)])
        getpros1.append(t)

    for i in range(len(getpros1)):
        getpros1[i]._getprocedure()
        time.sleep(10)

    # out = Output()
    # out.collect_data(column_val_view)
    # out.output1_txt()

    #
    # out = Output()
    # out.collect_data(column_val_pro)
    # out.output2_txt()

    # serviceId = serviceId[0:92]
    # t = GetData(serviceId)
    # getpros1.append(t)
    # getpros1[0]._getformview()

    # 数据库操作
    db = db.DB(column_val_pro,column_val_view)
    # db.createTable()
    db.InsertIntoMysql()
    # db.SelectData()


    # 部分办理依据含 a 标签
    # print(column_val_view[0][7])


